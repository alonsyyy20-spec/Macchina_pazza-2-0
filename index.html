<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Macchina Pazza 2.0</title>

<style>
  body {
    margin: 0;
    background: #777;
    overflow: hidden;
    touch-action: none;
    font-family: Arial, sans-serif;
  }

  .score {
    position: fixed;
    top: 10px;
    width: 100%;
    text-align: center;
    font-size: 24px;
    color: black;
    z-index: 10;
  }

  canvas {
    display: block;
    margin: auto;
    background: #aaa;
  }

  .controls {
    position: fixed;
    bottom: 20px;
    width: 100%;
    display: flex;
    justify-content: space-around;
    z-index: 10;
  }

  .controls button {
    width: 100px;
    height: 100px;
    font-size: 40px;
    border-radius: 20px;
    border: none;
    background: #ccc;
  }
</style>
</head>
<body>

<div class="score">Punteggio: <span id="score">0</span></div>
<canvas id="game"></canvas>

<div class="controls">
  <button ontouchstart="moveLeft()">⬅️</button>
  <button ontouchstart="moveRight()">➡️</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("score");

function resize() {
  canvas.width = Math.min(window.innerWidth, 500);
  canvas.height = window.innerHeight - 180;
}
window.addEventListener("resize", resize);
resize();

// STRADA A 3 CORSIE
const lanes = 3;
let laneWidth = canvas.width / lanes;

// macchina (quadrata)
let player = {
  lane: 1, // corsia centrale
  size: 30,
  y: canvas.height - 60
};

let obstacles = [];
let speed = 4;
let startTime = Date.now();

function moveLeft() {
  if (player.lane > 0) player.lane--;
}

function moveRight() {
  if (player.lane < lanes - 1) player.lane++;
}

function addObstacle() {
  obstacles.push({
    lane: Math.floor(Math.random() * lanes),
    y: -40,
    size: 30
  });
}

function update() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  laneWidth = canvas.width / lanes;

  // disegna corsie
  ctx.strokeStyle = "#555";
  for (let i = 1; i < lanes; i++) {
    ctx.beginPath();
    ctx.moveTo(i * laneWidth, 0);
    ctx.lineTo(i * laneWidth, canvas.height);
    ctx.stroke();
  }

  // macchina (quadrata)
  let playerX = player.lane * laneWidth + laneWidth / 2 - player.size / 2;
  ctx.fillStyle = "red";
  ctx.fillRect(playerX, player.y, player.size, player.size);

  // ostacoli
  ctx.fillStyle = "black";
  for (let o of obstacles) {
    o.y += speed;
    let ox = o.lane * laneWidth + laneWidth / 2 - o.size / 2;
    ctx.fillRect(ox, o.y, o.size, o.size);

    // collisione
    if (
      player.lane === o.lane &&
      o.y + o.size > player.y &&
      o.y < player.y + player.size
    ) {
      alert("Game Over!\nPunteggio: " + scoreEl.textContent);
      location.reload();
    }
  }

  obstacles = obstacles.filter(o => o.y < canvas.height);

  // punteggio = secondi vivi
  scoreEl.textContent = Math.floor((Date.now() - startTime) / 1000);

  requestAnimationFrame(update);
}

setInterval(addObstacle, 900);
update();
</script>

</body>
</html>
