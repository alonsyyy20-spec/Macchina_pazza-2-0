<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Macchina Pazza 2.0</title>

<style>
  body {
    margin: 0;
    background: #666;
    overflow: hidden;
    touch-action: none;
    font-family: Arial, sans-serif;
  }

  canvas {
    display: block;
    margin: auto;
    background: #aaa;
  }

  .controls {
    position: fixed;
    bottom: 20px;
    width: 100%;
    display: flex;
    justify-content: space-around;
  }

  .controls button {
    width: 100px;
    height: 100px;
    font-size: 40px;
    border-radius: 20px;
    border: none;
    background: #ccc;
  }
</style>
</head>
<body>

<canvas id="game"></canvas>

<div class="controls">
  <button ontouchstart="moveLeft()">‚¨ÖÔ∏è</button>
  <button ontouchstart="moveRight()">‚û°Ô∏è</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// resize per tablet / telefono
function resize() {
  canvas.width = Math.min(window.innerWidth, 500);
  canvas.height = window.innerHeight - 160;
}
window.addEventListener("resize", resize);
resize();

// STRADA
const lanes = 3;
let laneWidth = canvas.width / lanes;

// MACCHINA (QUADRATA ROSSA)
let player = {
  lane: 1,        // corsia centrale
  size: 40,       // üî¥ grande 40
  y: canvas.height - 80
};

let obstacles = [];
let speed = 4;
let startTime = Date.now();

// MOVIMENTO
function moveLeft() {
  if (player.lane > 0) player.lane--;
}

function moveRight() {
  if (player.lane < lanes - 1) player.lane++;
}

// OSTACOLI NERI
function addObstacle() {
  obstacles.push({
    lane: Math.floor(Math.random() * lanes),
    y: -50,
    size: 40
  });
}

// LOOP PRINCIPALE
function update() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  laneWidth = canvas.width / lanes;

  // sfondo strada
  ctx.fillStyle = "#aaa";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // corsie
  ctx.strokeStyle = "#555";
  ctx.lineWidth = 2;
  for (let i = 1; i < lanes; i++) {
    ctx.beginPath();
    ctx.moveTo(i * laneWidth, 0);
    ctx.lineTo(i * laneWidth, canvas.height);
    ctx.stroke();
  }

  // üî¢ PUNTEGGIO VISIBILE
  const score = Math.floor((Date.now() - startTime) / 1000);
  ctx.fillStyle = "black";
  ctx.font = "22px Arial";
  ctx.fillText("Punteggio: " + score, 10, 30);

  // macchina
  const playerX = player.lane * laneWidth + laneWidth / 2 - player.size / 2;
  ctx.fillStyle = "red";
  ctx.fillRect(playerX, player.y, player.size, player.size);

  // ostacoli
  ctx.fillStyle = "black";
  for (let o of obstacles) {
    o.y += speed;
    const ox = o.lane * laneWidth + laneWidth / 2 - o.size / 2;
    ctx.fillRect(ox, o.y, o.size, o.size);

    // collisione
    if (
      player.lane === o.lane &&
      o.y + o.size > player.y &&
      o.y < player.y + player.size
    ) {
      alert("Game Over!\nPunteggio: " + score);
      location.reload();
    }
  }

  obstacles = obstacles.filter(o => o.y < canvas.height);

  requestAnimationFrame(update);
}

// GENERAZIONE OSTACOLI
setInterval(addObstacle, 900);

// AVVIO
update();
</script>

</body>
</html>
